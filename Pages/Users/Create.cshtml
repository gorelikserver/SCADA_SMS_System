@page
@model SCADASMSSystem.Web.Pages.Users.CreateModel
@{
    ViewData["Title"] = "Create New User";
}

<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-user-plus me-2"></i>Create New User
        </h1>
        <a href="/Users" class="d-none d-sm-inline-block btn btn-sm btn-secondary shadow-sm">
            <i class="fas fa-arrow-left fa-sm text-white-50"></i> Back to Users
        </a>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- User Creation Form -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-user-cog me-2"></i>User Information
                    </h6>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="UserInput.UserName" class="form-label"></label>
                                <input asp-for="UserInput.UserName" class="form-control" placeholder="Enter full name">
                                <span asp-validation-for="UserInput.UserName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="UserInput.PhoneNumber" class="form-label"></label>
                                <input asp-for="UserInput.PhoneNumber" type="tel" class="form-control" placeholder="555-0123">
                                <span asp-validation-for="UserInput.PhoneNumber" class="text-danger"></span>
                                <div class="form-text">
                                    <i class="fas fa-mobile-alt me-1"></i>
                                    Enter phone number for SMS alerts
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="UserInput.Email" class="form-label"></label>
                                <input asp-for="UserInput.Email" type="email" class="form-control" placeholder="user@company.com (optional)">
                                <span asp-validation-for="UserInput.Email" class="text-danger"></span>
                                <div class="form-text">
                                    <i class="fas fa-envelope me-1"></i>
                                    Email is optional but recommended for notifications
                                </div>
                            </div>
                        </div>

                        <hr>

                        <h6 class="font-weight-bold text-primary mb-3">
                            <i class="fas fa-cog me-2"></i>Notification Settings
                        </h6>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input asp-for="UserInput.SmsEnabled" class="form-check-input" type="checkbox" role="switch">
                                    <label asp-for="UserInput.SmsEnabled" class="form-check-label">
                                        <strong>Enable SMS Notifications</strong>
                                    </label>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-mobile-alt me-1"></i>
                                    User will receive SMS alerts during system events and alarms
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch">
                                    <input asp-for="UserInput.SpecialDaysEnabled" class="form-check-input" type="checkbox" role="switch">
                                    <label asp-for="UserInput.SpecialDaysEnabled" class="form-check-label">
                                        <strong>Available on Special Days/Holidays</strong>
                                    </label>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-calendar-check me-1"></i>
                                    User is available to work during Jewish holidays and sabbatical days
                                </div>
                            </div>
                        </div>

                        <hr>

                        <div class="d-flex justify-content-between">
                            <a href="/Users" class="btn btn-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Create User
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Help & Guidelines -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-info">
                        <i class="fas fa-info-circle me-2"></i>User Creation Guidelines
                    </h6>
                </div>
                <div class="card-body">
                    <h6 class="font-weight-bold">Required Information:</h6>
                    <ul class="small">
                        <li><strong>Full Name:</strong> User's complete name for identification</li>
                        <li><strong>Phone Number:</strong> Mobile number for SMS alerts (required)</li>
                        <li><strong>Email:</strong> Email address for notifications (optional)</li>
                    </ul>

                    <h6 class="font-weight-bold mt-3">SMS Settings:</h6>
                    <ul class="small">
                        <li><strong>SMS Enabled:</strong> User receives SMS notifications during alarms</li>
                        <li><strong>Holiday Available:</strong> User is on-call during Jewish holidays</li>
                    </ul>

                    <h6 class="font-weight-bold mt-3">Special Day Settings:</h6>
                    <p class="small">
                        The "Special Days" setting determines if a user receives SMS notifications during
                        Jewish holidays and sabbatical days. This respects religious observances while
                        ensuring critical personnel are available for emergencies.
                    </p>

                    <div class="mt-3 p-2 bg-light rounded">
                        <small class="text-muted">
                            <i class="fas fa-lightbulb me-1"></i>
                            <strong>Tip:</strong> Most users should have SMS enabled. Only disable for users who shouldn't receive emergency alerts.
                        </small>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-success">
                        <i class="fas fa-chart-bar me-2"></i>System Statistics
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="small font-weight-bold">Total Users:</span>
                        <span class="badge bg-primary text-white" id="totalUsersCount">--</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="small font-weight-bold">SMS Enabled:</span>
                        <span class="badge bg-success text-white" id="smsEnabledCount">--</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="small font-weight-bold">Holiday Workers:</span>
                        <span class="badge bg-warning text-dark" id="holidayWorkersCount">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Load statistics on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadUserStatistics();
        });

        async function loadUserStatistics() {
            try {
                // You can implement an API endpoint to get these stats
                // For now, we'll show placeholder values
                document.getElementById('totalUsersCount').textContent = '5';
                document.getElementById('smsEnabledCount').textContent = '4';
                document.getElementById('holidayWorkersCount').textContent = '3';
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Phone number formatting - more flexible approach
        document.querySelector('input[name="UserInput.PhoneNumber"]').addEventListener('input', function(e) {
            // Don't auto-format - just clean up the input
            let value = e.target.value;
            
            // Only allow valid phone number characters
            value = value.replace(/[^+\d\s\-\(\)]/g, '');
            
            // Update the field with cleaned value
            e.target.value = value;
        });

        // Form validation feedback
        document.querySelector('form').addEventListener('submit', function(e) {
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating User...';
            submitBtn.disabled = true;
        });
    </script>
}